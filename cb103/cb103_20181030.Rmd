---
title: "R_basic2"
author: "York Lin"
date: "2018年10月30日"
output: html_document
editor_options: 
  chunk_output_type: console
---

###readr package
- http://hadley.nz/
- https://github.com/tidyverse/readr

```{R}
#install.packages("tidyverse")
#install.packages("readr")
library('tidyverse')
setwd('~/lecture/riii')
stock = read_csv('data/2330.csv',col_names=T)
```

### read excel file
```{R}
library(readxl)
setwd('~/lecture/riii/')
FinancialReport <- read_excel("./data/FinancialReport.xlsx")
#View(FinancialReport)
summary(FinancialReport)
```

### read json
```{R}
setwd('~/lecture/riii/')
download.file('https://www.railway.gov.tw/Upload/UserFiles/%E8%87%BA%E9%90%B5%E5%B1%80%E6%88%BF%E5%9C%B0%E7%94%A2%E5%87%BA%E7%A7%9F%E6%83%85%E5%BD%A2.json', destfile = './data/rent.json')

library(jsonlite)
json_data<- fromJSON('./data/rent.json')
head(json_data)
```

### read xml
```{R}
library(XML)
url <- 'http://opendata.epa.gov.tw/ws/Data/ATM00698/?$format=xml'
weather <- xmlToDataFrame(url)
#View(weather)
weather[ weather$SiteName == '臺北',  'Temperature'   ]
```

### Flow Control
```{R}
x=5;
if(x>3){
  print("x > 3")
}else{
  print("x <= 3")
}

if(x>3) print("x > 3") else print("x <= 3")

test = ifelse(x>3,"x > 3","x <= 3")
test

x=5;
if(x>3){
  print ("x > 3");
} else if (x ==3){
  print ("x == 3");
}else{
  print("x <= 3");
}

switch(2,print("aaa"),print("bbb"),print("ccc"))
switch("third",first=print("aaa"),second=print("bbb"),third=print("ccc"))

for(i in 1:10){
  print(i);
}

sum=0
for(i in 1:100){
  sum= sum+ i;
}
sum

sum(1:100)


sum = 0;
cnt = 0;
while(cnt <= 100){
  sum = sum + cnt;
  cnt = cnt + 1;
}
sum

mat = matrix(1:9, byrow=TRUE, nrow=3)
for(i in 1:nrow(mat)){
  for(j in 1:ncol(mat)){
    print(mat[i,j])
  }
}

for(i in seq_len(nrow(mat))) {
  for(j in seq_len(ncol(mat))) { 
    print(mat[i, j])
  }
}

```

### Review seq()
```{R}
mat = matrix(1:9, byrow=TRUE, nrow=3)
1:3
1:nrow(mat)
seq(from=1,to=nrow(mat),by=1)
seq_len(nrow(mat))
```

### break / next
```{R}
#break(跳出迴圈)
for(n in 1:10){
  if(n==5){
    break
  }
  print(n)
}

#next(略過本次,類似python continue)
for(n in 1:10){
  if(n==5){
    next
  }
  print(n)
}

```


### p86 example
```{R}
#method1
mat = matrix(rep(1,9^2),nrow = 9)
#mat = matrix(nrow=9,ncol=9)
for(i in 1:nrow(mat)){
  for(j in 1:ncol(mat)){
    #mat[i,j] = i * j;
    #mat[i,j] = paste(i,"*",j,"= ",i*j)
    mat[i,j] = sprintf(" %s * %s = %s",i,j,i*j)
  }
}

#method2
mat1 = matrix(1:9, nrow = 9);
mat2 = matrix(1:9, nrow = 1);
mat = mat1 %*% mat2;
mat
```

### Function
```{R}
f = function(a){
    return(a+3)
}
f(3)

#with default arguments
f1 = function(a = 3) {
    return(a+3)
}
f1()

#lazy function
f2 = function(a, b = 2, c = NULL) {
   return(b + 1)
}
f2()

#local variable
b = 3
f3 = function(a) {
    b = 2
    return(b)
}
f3()

f4 = function(a,b){
    if(a > 3){
       a = 100;
    }
    return(a + b);
}
f4(4,1)
```
